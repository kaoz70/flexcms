;(function(h){h.fn.stackGallery=function(C){function Sa(a){var b=a*Math.PI/180;a=Math.cos(b);var b=Math.sin(b),c=v,f=w;X=Math.round(c*Math.abs(a)+f*Math.abs(b));Y=Math.round(c*Math.abs(b)+f*Math.abs(a));ya=Y-w;za=X-v}function Ta(a,b,c){a=a*Math.PI/180;var f=Math.cos(a),e=Math.sin(a),d=f*b;a=e*b;var g=-e*c,m=f*c,h=f*b-e*c;c=e*b+f*c;b=Math.min(0,d,g,h);d=Math.max(0,d,g,h);g=Math.min(0,a,m,c);a=Math.max(0,a,m,c);Aa=Math.round(d-b);Ba=Math.round(a-g)}function ia(){var a=0,b,c,f,e;r&&Sa(O);var d=q("w"), g=q("h");for(a;a<p;a++){b=h(l[a]);c=b.find("div[class=scaler]");if(Ca||J>d||K>g||X>d||Y>g){if(r){if(e={},e.width=g/(w+ya)*v,e.height=g,Ta(O,e.width,e.width*y),L="width",Aa-1>d||Ba-1>g)e.height=d/(v+za)*w,e.width=d,L="height"}else e=Da(P,v,w,!0);f=e.width;e=e.height}else f=v,e=w;if(!Q)b&&("width"==L?(b.width(f),b.height(f*y)):(b.height(e),b.width(e*M))),c&&("width"==L?(c.width(f-2*B),c.height(b.width()*y-2*B)):(c.height(e-2*B),c.width(b.height()*M-2*B)));else if(Ca||J>d||K>g||X>d||Y>g||b.width()<J|| b.height()<K)b&&("width"==L?(b.width(f),b.height(f*y)):(b.height(e),b.width(e*M))),c&&("width"==L?(c.width(f-2*B),c.height(b.width()*y-2*B)):(c.height(e-2*B),c.width(b.height()*M-2*B)))}r?"width"==L?D.css({left:"50%",top:"50%",width:f+"px",height:b.width()*y+"px",marginLeft:-f/2+"px",marginTop:-(b.width()*y)/2+"px"}):D.css({left:"50%",top:"50%",height:e+"px",width:b.height()*M+"px",marginLeft:-(b.height()*M)/2+"px",marginTop:-(b.width()*y)/2+"px"}):D.css({left:"50%",top:"50%",width:f+"px",height:b.width()* y+"px",marginLeft:-f/2-(Z+$)/2+"px",marginTop:-(b.width()*y)/2-(aa+ba)/2+"px"});t&&("rightCenter"==Ea?(a=q("w")/2+D.width()/2+t.width(),a>q("w")-t.width()-20&&(a=q("w")-t.width()-20),t.css("left",a+"px")):"topCenter"==Ea&&(a=q("h")/2-D.height()/2-t.height()-10,10>a&&(a=10),t.css("top",a+"px")));a=0;b=ja.length;var m;for(a;a<b;a++)c=h(ja[a]),c.find("div[data-type=caption]").each(function(){m=h(this);m.removeClass("caption_font_small").removeClass("caption_font_medium").removeClass("caption_font_large"); 570>=q("w")||320>=q("h")?m.addClass("caption_font_small"):767>=q("w")||570>=q("h")?m.addClass("caption_font_medium"):(959>=q("w")||767>=q("h"))&&m.addClass("caption_font_large")});if(r&&Q)for(a=0;a<p;a++)div=h(l[a]),a!=p-1&&div.css({rotate:Fa[a]+"deg"})}function Da(a,b,c,f){a={};var e=q("w")-(J-v),d=q("h")-(K-w),g=(e-0)/(d-0),h=b/c;h<g?f?(a.width=(d-0)/c*b,a.height=d-0):(a.height=(e-0)/b*c,a.width=e-0):h>g?f?(a.height=(e-0)/b*c,a.width=e-0):(a.width=(d-0)/c*b,a.height=d-0):(a.width=e-0,a.height=d- 0);return a}function Da(a,b,c,f){a={};var e=q("w")-(J-v),d=q("h")-(K-w),g=(e-0)/(d-0),h=b/c;h<g?f?(a.width=(d-0)/c*b,a.height=d-0):(a.height=(e-0)/b*c,a.width=e-0):h>g?f?(a.height=(e-0)/b*c,a.width=e-0):(a.width=(d-0)/c*b,a.height=d-0):(a.width=e-0,a.height=d-0);return a}function Ga(){var a=h(l[0]);r?(E=a.outerHeight()+100,R=a.outerWidth()+50):(E=a.outerHeight()+10,R=a.outerWidth()+5)}function ca(a,b){var c=p-1,f=parseInt(h(l[c]).attr("data-orig-id"),10);beforeSlideChange(f);void 0!=l[c].data("captionSubArr")&& Ha(c);var e;e=a?b?h(ka(a)):h(la(a)):h(la(c));var d=Math.random()*(Ia-da)+da,g=Math.random()*(ea-N)+N,m=0,k=0;Ga();if("verticalAbove"==z||"verticalRound"==z)r?F?e.animate({top:-E+"px"},{duration:n,easing:"easeOutSine",step:function(a,b){k=Math.round(a*n/E);m=-(k*d/n);setTimeout(function(){e.css("-webkit-transform","rotate("+m+"deg)")},65)},complete:function(){ma(e,g,m,a,b)}}):e.animate({rotate:d+"deg",top:-E+"px"},{duration:n,easing:"easeOutCubic",complete:function(){ma(e,g,m,a,b)}}):e.animate({top:-E+ "px"},{duration:n,easing:"easeOutCubic",complete:function(){ma(e,g,m,a,b)}});else{var A="horizontalLeft"==z?-R:R;r?F?e.animate({left:A+"px"},{duration:n,easing:"easeOutSine",step:function(a,b){k=Math.round(a*n/A);m="horizontalLeft"==z?k*d/n:-(k*d/n);setTimeout(function(){e.css("-webkit-transform","rotate("+m+"deg)")},65)},complete:function(){na(e,g,m,a,b)}}):e.animate({rotate:d+"deg",left:A+"px"},{duration:n,easing:"easeOutCubic",complete:function(){na(e,g,m,a,b)}}):e.animate({left:A+"px"},{duration:n, easing:"easeOutCubic",complete:function(){na(e,g,m,a,b)}})}}function ma(a,b,c,f,e){f?(e&&(f=h(ka(f)).attr("data-id")),e=l[f],l.splice(f,1),l.push(e)):l.unshift(l.pop());Ja();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),10));e=b;if(r)if(F){var d,g,m=0,n=0,A,q=parseInt(a.css("top"),10);f&&(b=0);0>c&&0>b&&c>b?(d=Math.abs(Math.abs(c)-Math.abs(b)),g="-"):0<c&&0<b&&c>b?(d=c-b,g="-"):0<c&&0>b?(d=c+Math.abs(b),g="-"):0>c&&0>b&&c<b?(d=Math.abs(Math.abs(c)-Math.abs(b)),g="+"):0<c&&0<b&&c<b?(d=b- c,g="+"):0>c&&0<b?(d=Math.abs(c)+b,g="+"):0==c&&0<b?(d=b,g="+"):0<c&&0==b?(d=c,g="-"):0>c&&0==b?(d=Math.abs(c),g="+"):0==c&&0>b&&(d=Math.abs(b),g="-");a.animate({top:"0px"},{duration:k,easing:"easeOutSine",step:function(b,e){n=-Math.round(b*k/q-k);m=n*d/k;setTimeout(function(){A="+"==g?c+m:c-m;a.css("-webkit-transform","rotate("+A+"deg)")},65)}})}else f?a.animate({rotate:"0deg",top:"0px"},{duration:k,easing:"easeOutExpo"}):a.animate({rotate:b+"deg",top:"0px"},{duration:k,easing:"easeOutExpo"});else b= 0,void 0!=a.data("origTop")&&(b=parseInt(a.data("origTop"),10)),a.animate({top:b+"px"},{duration:k,easing:"easeOutExpo"});r&&(f?h(l[p-2]).animate({rotate:e+"deg",duration:k,easing:"easeOutSine"}):h(l[p-1]).animate({rotate:"0deg",duration:k,easing:"easeOutExpo"}));G&&clearTimeout(G);G=setTimeout(Ka,k)}function na(a,b,c,f,e){f?(e&&(f=h(ka(f)).attr("data-id")),e=l[f],l.splice(f,1),l.push(e)):l.unshift(l.pop());Ja();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),10));e=b;if(r)if(F){var d,g, m=0,n=0,A,q=parseInt(a.css("left"),10);f&&(b=0);0>c&&0>b&&c>b?(d=Math.abs(Math.abs(c)-Math.abs(b)),g="-"):0<c&&0<b&&c>b?(d=c-b,g="-"):0<c&&0>b?(d=c+Math.abs(b),g="-"):0>c&&0>b&&c<b?(d=Math.abs(Math.abs(c)-Math.abs(b)),g="+"):0<c&&0<b&&c<b?(d=b-c,g="+"):0>c&&0<b?(d=Math.abs(c)+b,g="+"):0==c&&0<b?(d=b,g="+"):0<c&&0==b?(d=c,g="-"):0>c&&0==b?(d=Math.abs(c),g="+"):0==c&&0>b&&(d=Math.abs(b),g="-");a.animate({left:"0px"},{duration:k,easing:"easeOutSine",step:function(b,e){n=-Math.round(b*k/q-k);m=n*d/k; setTimeout(function(){A="+"==g?c+m:c-m;a.css("-webkit-transform","rotate("+A+"deg)")},65)}})}else f?a.animate({rotate:"0deg",left:"0px"},{duration:k,easing:"easeOutExpo"}):a.animate({rotate:b+"deg",left:"0px"},{duration:k,easing:"easeOutExpo"});else b=0,void 0!=a.data("origLeft")&&(b=parseInt(a.data("origLeft"),10)),a.animate({left:b+"px"},{duration:k,easing:"easeOutExpo"});r&&(f?h(l[p-2]).animate({rotate:e+"deg",duration:k,easing:"easeOutSine"}):h(l[p-1]).animate({rotate:"0deg",duration:k,easing:"easeOutExpo"})); G&&clearTimeout(G);G=setTimeout(Ka,k)}function La(){var a=h(l[p-1]).attr("data-id"),b=parseInt(h(l[a]).attr("data-orig-id"),10);beforeSlideChange(b);void 0!=l[a].data("captionSubArr")&&Ha(a);var c=h(la(0)),f=Math.random()*(Ia-da)+da,e=Math.random()*(ea-N)+N,d=0,g=0;Ga();if("verticalAbove"==z||"verticalRound"==z){var m="verticalRound"==z?E:-E;r?F?c.animate({top:m+"px"},{duration:n,easing:"easeOutSine",step:function(a,b){g=Math.round(a*n/m);d="verticalRound"==z?-(g*f/n):g*f/n;setTimeout(function(){c.css("-webkit-transform", "rotate("+d+"deg)")},65)},complete:function(){oa(c,e,d)}}):c.animate({rotate:f+"deg",top:m+"px"},{duration:n,easing:"easeOutCubic",complete:function(){oa(c,e)}}):c.animate({top:m+"px"},{duration:n,easing:"easeOutCubic",complete:function(){oa(c)}})}else{var k="horizontalLeft"==z?-R:R;r?F?c.animate({left:k+"px"},{duration:n,easing:"easeOutSine",step:function(a,b){g=Math.round(a*n/k);d="horizontalLeft"==z?-(g*f/n):g*f/n;setTimeout(function(){c.css("-webkit-transform","rotate("+d+"deg)")},65)},complete:function(){pa(c, e,d)}}):c.animate({rotate:f+"deg",left:k+"px"},{duration:n,easing:"easeOutCubic",complete:function(){pa(c,e)}}):c.animate({left:k+"px"},{duration:n,easing:"easeOutCubic",complete:function(){pa(c)}})}}function oa(a,b,c){l.push(l.shift());Ma();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),10));if(r)if(h(l[p-2]).animate({rotate:b+"deg",duration:k,easing:"easeOutSine"}),F){var f=Math.abs(c),e,d=0,g=0,m,n=parseInt(a.css("top"),10);0<c?e="-":0>c&&(e="+");a.animate({top:"0px"},{duration:k,easing:"easeOutSine", step:function(b,h){g=-Math.round(b*k/n-k);d=g*f/k;setTimeout(function(){m="+"==e?Math.floor(c+d):Math.floor(c-d);a.css("-webkit-transform","rotate("+m+"deg)")},65)},complete:function(){H(a.attr("data-id"))}})}else a.animate({rotate:"0deg",top:"0px"},{duration:k,easing:"easeOutExpo",complete:function(){H(a.attr("data-id"))}});else b=0,void 0!=a.data("origTop")&&(b=parseInt(a.data("origTop"),10)),a.animate({top:b+"px"},{duration:k,easing:"easeOutExpo",complete:function(){H(a.attr("data-id"))}})}function pa(a, b,c){l.push(l.shift());Ma();void 0!=a.data("max_rot")&&(b=parseInt(a.data("max_rot"),10));if(r)if(h(l[p-2]).animate({rotate:b+"deg",duration:k,easing:"easeOutSine"}),F){var f=Math.abs(c),e,d=0,g=0,m,n=parseInt(a.css("left"),10);0<c?e="-":0>c&&(e="+");a.animate({left:"0px"},{duration:k,easing:"easeOutSine",step:function(b,h){g=-Math.round(b*k/n-k);d=g*f/k;setTimeout(function(){m="+"==e?Math.floor(c+d):Math.floor(c-d);a.css("-webkit-transform","rotate("+m+"deg)")},65)},complete:function(){H(a.attr("data-id"))}})}else a.animate({rotate:"0deg", left:"0px"},{duration:k,easing:"easeOutExpo",complete:function(){H(a.attr("data-id"))}});else b=0,void 0!=a.data("origLeft")&&(b=parseInt(a.data("origLeft"),10)),a.animate({left:b+"px"},{duration:k,easing:"easeOutExpo",complete:function(){H(a.attr("data-id"))}})}function Ha(a){var b=0,c=l[a].data("captionSubArr"),f=l[a].data("caption_list");a=c.length;var e;for(b;b<a;b++)e=h(c[b]),b!=a-1?e.stop().animate({opacity:0},{duration:fa,easing:"easeOutQuint"}):e.stop().animate({opacity:0},{duration:fa,easing:"easeOutQuint", complete:function(){f.css("display","none")}})}function H(a){var b=parseInt(h(l[a]).attr("data-orig-id"),10);afterSlideChange(b);if(void 0!=l[a].data("captionSubArr")){var b=0,c=l[a].data("captionSubArr"),f=l[a].data("caption_list");a=c.length;f.css("display","block");for(b;b<a;b++)f=h(c[b]),f.css("opacity",0),f.css("left","-100px"),b!=a-1?f.delay(Na*b).animate({opacity:1,left:"0px"},{duration:fa,easing:"easeOutQuart"}):b==a-1&&f.delay(Na*b).animate({opacity:1,left:"0px"},{duration:fa,easing:"easeOutQuart", complete:function(){V("on");s=!1;u&&!ga&&S()}})}else V("on"),s=!1,u&&!ga&&S()}function q(a){return"w"==a?P.width():P.height()}function Ka(){G&&clearTimeout(G);H(h(l[p-1]).attr("data-id"))}function ha(){W&&clearTimeout(W);I.find("img").attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/play.png")}function S(){W&&clearTimeout(W);W=setTimeout(Ua,Oa);I.find("img").attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/pause.png")}function Va(a){if(!x)return!1;"right"==a?qa():"left"==a&&ra();return!1}function Ua(){s=!0;V("off");"forward"==Pa?ca():La()}function V(a){"on"== a?(T.css("cursor","pointer"),U.css("cursor","pointer")):(T.css("cursor","default"),U.css("cursor","default"))}function qa(){s=!0;V("off");La()}function ra(){s=!0;V("off");ca()}function sa(a){if(!x)return!1;a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();a=h(a.currentTarget).attr("class");if("controls_previous"==a){if(s)return;qa()}else if("controls_toggle"==a)Qa();else if("controls_next"==a){if(s)return;ra()}return!1}function ta(a){if(!x)return!1;a||(a=window.event);a.cancelBubble= !0;a.stopPropagation&&a.stopPropagation();var b=a.currentTarget;a=h(b).attr("class");b=h(b).find("img");"controls_previous"==a?b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/prev_on.png"):"controls_toggle"==a?u?b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/pause_on.png"):b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/play_on.png"):"controls_next"==a&&b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/next_on.png");return!1}function ua(a){if(!x)return!1;a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();var b=a.currentTarget;a=h(b).attr("class");b=h(b).find("img"); "controls_previous"==a?b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/prev.png"):"controls_toggle"==a?u?b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/pause.png"):b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/play.png"):"controls_next"==a&&b.attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/next.png");return!1}function la(a){var b=0,c,f;for(b;b<p&&(c=h(l[b]),f=c.attr("data-id"),f!=a);b++);return c}function ka(a){var b=0,c,f;for(b;b<p&&(c=h(l[b]),f=c.attr("data-orig-id"),f!=a);b++);return c}function Ja(){var a=0,b;for(a;a<p;a++)b=h(l[a]),b.attr("data-id",a),b.css("zIndex",a+va)}function Ma(){var a= 0,b;for(a;a<p;a++)b=h(l[a]),b.attr("data-id",a),b.css("zIndex",a+va)}function Wa(a,b){for(var c=a.length;c--;)if(parseInt(a[c],10)===b)return!0;return!1}function Qa(){u?(ha(),u=!1):(u=!0,s||S())}var x=!1,Xa=jQuery(window);/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);var Q=!1,Ra=function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a}();-1!=Ra&&9>Ra&&(Q=!0);var Fa= [],F=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),P=h(this),D=P.find(".componentPlaylist");D.css("zIndex",0);var va=1,u=C.slideshowOn,Oa=C.slideshowDelay,W,Ca=C.fullSize,Ea=C.controlsAlignment,Ya=C.swipeOn.split(","),y,M,B,O=0,L="width",ja=[],wa,l=[],r=C.useRotation,s=!1,G,p,xa=!1,v,w,J,K,X,Y,Aa,Ba,aa=0,Z=0,ba=500,$=500,n=500,k=500,da=-25,Ia=-15,N=10,ea=-10,ya=0,za=0,z=C.slideshowLayout,Pa=C.slideshowDirection,Na=150,fa=500,E,R,t=P.find(".componentControls"),T=t.find(".controls_previous"), I=t.find(".controls_toggle"),U=t.find(".controls_next");T.css("cursor","pointer");I.css("cursor","pointer");U.css("cursor","pointer");T.bind("click touchstart",sa);I.bind("click touchstart",sa);U.bind("click touchstart",sa);T.bind("mouseover",ta);I.bind("mouseover",ta);U.bind("mouseover",ta);T.bind("mouseout",ua);I.bind("mouseout",ua);U.bind("mouseout",ua);u?I.find("img").attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/pause.png"):I.find("img").attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/play.png");var ga=!1;D.mouseenter(function(a){ga=!0;u&& ha()}).mouseleave(function(){ga=!1;s||!u||xa||S()});Xa.resize(function(){if(!x)return!1;wa&&clearTimeout(wa);wa=setTimeout(ia,25)});(function(){var a,b,c,f,e,d,g=0;d=D.find("div[class=slide]");var k,n;p=d.length;d.each(function(){l.push(h(this))});a=h(l[0]);v=a.width();w=a.height();y=w/v;M=v/w;d=a.find("div[class=scaler]");d.height();d.width();B=(a.width()-d.width())/2;for(g;g<p;g++){d=h(l[g]);d.attr("data-id",g);d.attr("data-orig-id",g);d.css("zIndex",g+va);r?(a=Math.random()*(ea-N)+N,Math.abs(a)> O&&(O=Math.abs(a),k=Math.abs(a),n=g),Q?Fa.push(a):g!=p-1&&d.css({rotate:a+"deg"})):(a=35*Math.random(),b=25*Math.random(),a>aa&&(aa=a),b>Z&&(Z=b),a<ba&&(ba=a),b<$&&($=b),d.css("top",a+"px"),d.css("left",b+"px"),d.data("origTop",a),d.data("origLeft",b));d.find("a[class=pp_content]").bind("click",function(){xa=!0;u&&ha();detailActivated();return!1}).bind("mouseover",function(){h(this).find("img").attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/detail_on.png");return!1}).bind("mouseout",function(){h(this).find("img").attr("src", system.baseUrl + "assets/public/banners/StackBanner/images/icons/detail.png");return!1});d.find("a[class=pp_link]").bind("mouseover",function(){h(this).find("img").attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/link_on.png");return!1}).bind("mouseout",function(){h(this).find("img").attr("src",system.baseUrl + "assets/public/banners/StackBanner/images/icons/link.png");return!1});Wa(Ya,g)&&(d.bind("dragstart",function(a){a.preventDefault();return!1}).bind("selectstart",function(a){a.preventDefault();return!1}),d.touchSwipe(Va,!0));j=0;f=d.find("div[class=caption_list]");ja.push(f);a=f.find("div[data-type=caption]");b=a.length; c=[];for(j;j<b;j++)e=a.eq(j),e.css("opacity",0),c.push(e);0<b&&(d.data("caption_list",f),d.data("captionSubArr",c));d.css("opacity",0);d.stop().animate({opacity:1},{duration:1E3,easing:"easeOutSine"})}N=O;ea=-O;r?(d=h(l[n]),d.data("max_rot",k),J=v,K=w):(J=Z+v-$,K=aa+w-ba);Q||ia();H(p-1);P.css("opacity",1);t&&(t.css("opacity",0),t.css("display","block"),t.stop().animate({opacity:1},{duration:1E3,easing:"easeOutSine"}));x=!0;stackGalleryReady();Q&&ia()})();this.checkSlideshow2=function(){xa=!1;u&&(s|| S());detailClosed()};this.toggleSlideshow=function(a){x&&(void 0==a?Qa():a?(u=!0,s||S()):(ha(),u=!1))};this.toggleDirection=function(a){!x||"forward"!=a&&"backward"!=a||(Pa=a)};this.setSlideshowDelay=function(a){x&&(Oa=a)};this.nextMedia=function(){x&&(s||ra())};this.previousMedia=function(){x&&(s||qa())};this.openMedia=function(a){x&&!s&&(0>a?a=0:a>p-1&&(a=p-1),h(l[p-1]).attr("data-id")!=a&&ca(a,!1))};this.openOriginalMedia=function(a){x&&!s&&(0>a?a=0:a>p-1&&(a=p-1),h(l[p-1]).attr("data-orig-id")!= a&&ca(a,!0))};return this}})(jQuery);